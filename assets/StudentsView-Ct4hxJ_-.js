import{a as k,b as E,u as O}from"./api-client-v2akKp4R.js";import{d as q,a as f,k as j,l as B,b as l,o as b,m as S,e as a,w as n,g as y,n as I,f as $,c as Q,p as K,_ as R,F as T,u as U,t as M}from"./index-DMjYued5.js";import"./base-url-qR72hEjy.js";const D={async getStudents(){const c=await k.get("/school/student/list/");return console.log(c.data),c.data},async addStudent(c){return(await k.post("/school/student/",c,{headers:{"Content-Type":"multipart/form-data"}})).data},async updateStudent(c,d){return(await k.put(`/school/student/${c}`,d,{headers:{"Content-Type":"multipart/form-data"}})).data},async deleteStudent(c){return(await k.delete(`/school/student/${c}`)).data}},W={class:"d-flex"},z=q({__name:"AddStudentFormDialog",setup(c){const d=f(!1),s=f(!1),r=f(!1),w=E(),t=f({name:"",login:"",password:"",image:null}),m=f(null),o=i=>{const e=i.target;e.files&&e.files[0]&&(t.value.image=e.files[0],m.value=URL.createObjectURL(e.files[0]))},v=j(()=>t.value.login&&t.value.password&&t.value.name),x=async()=>{if(!v.value)return alert("Please fill in all fields and upload an avatar.");const i=new FormData;i.append("name",t.value.name),i.append("login",t.value.login),i.append("password",t.value.password),t.value.image!=null&&i.append("image",t.value.image),r.value=!0;try{await D.addStudent(i),w.invalidateQueries({queryKey:["students"]}),d.value=!1}catch(e){alert(`Failed to add student: ${e}`)}finally{r.value=!1}};return B(d,i=>{i==!1&&(t.value={name:"",login:"",password:"",image:null},m.value=null)}),(i,e)=>{const g=l("v-btn"),V=l("v-card-title"),_=l("v-text-field"),C=l("v-file-input"),p=l("v-img"),F=l("v-form"),A=l("v-card-text"),N=l("v-card-actions"),L=l("v-card"),P=l("v-dialog");return b(),S("div",null,[a(g,{color:"green",variant:"flat",onClick:e[0]||(e[0]=u=>d.value=!0)},{default:n(()=>e[8]||(e[8]=[y(" + Add ")])),_:1}),a(P,{modelValue:d.value,"onUpdate:modelValue":e[7]||(e[7]=u=>d.value=u),"max-width":"600"},{default:n(()=>[a(L,{class:"pa-4"},{default:n(()=>[a(V,{class:"px-2"},{default:n(()=>e[9]||(e[9]=[y("Create a New Student")])),_:1}),a(A,null,{default:n(()=>[a(F,{onSubmit:I(x,["prevent"])},{default:n(()=>[a(_,{modelValue:t.value.name,"onUpdate:modelValue":e[1]||(e[1]=u=>t.value.name=u),type:"text",density:"compact",label:"Name",placeholder:"Name Surname","prepend-inner-icon":"mdi-account-outline",variant:"outlined",required:""},null,8,["modelValue"]),a(_,{modelValue:t.value.login,"onUpdate:modelValue":e[2]||(e[2]=u=>t.value.login=u),type:"email",density:"compact",label:"Email",placeholder:"Email address","prepend-inner-icon":"mdi-email-outline",variant:"outlined",required:""},null,8,["modelValue"]),a(_,{modelValue:t.value.password,"onUpdate:modelValue":e[3]||(e[3]=u=>t.value.password=u),"append-inner-icon":s.value?"mdi-eye-off":"mdi-eye",type:s.value?"text":"password",density:"compact",label:"Password",placeholder:"Enter password","prepend-inner-icon":"mdi-lock-outline",variant:"outlined","onClick:appendInner":e[4]||(e[4]=u=>s.value=!s.value),required:""},null,8,["modelValue","append-inner-icon","type"]),$("div",W,[a(C,{modelValue:t.value.image,"onUpdate:modelValue":e[5]||(e[5]=u=>t.value.image=u),"max-width":"100%",variant:"outlined",accept:"image/png, image/jpeg, image/bmp",label:"Avatar",placeholder:"Pick an avatar","prepend-icon":"mdi-camera",onChange:o,counter:"",required:""},null,8,["modelValue"]),m.value?(b(),Q(p,{key:0,src:m.value,"max-width":"60","max-height":"60",class:"pa-0 ma-0"},null,8,["src"])):K("",!0)])]),_:1})]),_:1}),a(N,null,{default:n(()=>[a(g,{color:"red darken-1",variant:"text",onClick:e[6]||(e[6]=u=>d.value=!1)},{default:n(()=>e[10]||(e[10]=[y(" Cancel ")])),_:1}),a(g,{loading:r.value,color:"primary",variant:"flat",disabled:!v.value||r.value,onClick:x},{default:n(()=>e[11]||(e[11]=[y(" Submit ")])),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),G=R(z,[["__scopeId","data-v-dc85d31a"]]),H={class:"d-flex"},J=q({__name:"UpdateStudentFormDialog",props:{item:{}},setup(c){const d=c,s=f(!1),r=f(!1),w=E(),t=f({name:d.item.name,image:null}),m=f(null);m.value=d.item.image;const o=i=>{const e=i.target;e.files&&e.files[0]&&(t.value.image=e.files[0],m.value=URL.createObjectURL(e.files[0]))},v=j(()=>t.value.name),x=async()=>{if(!v.value)return alert("Please fill in all fields and upload an avatar.");const i=new FormData;i.append("name",t.value.name),t.value.image!=null&&i.append("image",t.value.image),r.value=!0;try{await D.updateStudent(d.item.id,i),w.invalidateQueries({queryKey:["students"]}),s.value=!1}catch(e){alert(`Failed to update student: ${e}`)}finally{r.value=!1}};return B(s,i=>{i&&(t.value.name=d.item.name,t.value.image=null,m.value=d.item.image)}),(i,e)=>{const g=l("v-btn"),V=l("v-card-title"),_=l("v-text-field"),C=l("v-file-input"),p=l("v-img"),F=l("v-form"),A=l("v-card-text"),N=l("v-card-actions"),L=l("v-card"),P=l("v-dialog");return b(),S(T,null,[a(g,{icon:"mdi-pencil",variant:"plain",onClick:e[0]||(e[0]=u=>s.value=!0)}),a(P,{modelValue:s.value,"onUpdate:modelValue":e[4]||(e[4]=u=>s.value=u),"max-width":"600"},{default:n(()=>[a(L,{class:"pa-4"},{default:n(()=>[a(V,{class:"px-2"},{default:n(()=>e[5]||(e[5]=[y("Update Student")])),_:1}),a(A,null,{default:n(()=>[a(F,{onSubmit:I(x,["prevent"])},{default:n(()=>[a(_,{modelValue:t.value.name,"onUpdate:modelValue":e[1]||(e[1]=u=>t.value.name=u),type:"text",density:"compact",label:"Name",placeholder:"Name Surname","prepend-inner-icon":"mdi-account-outline",variant:"outlined",required:""},null,8,["modelValue"]),$("div",H,[a(C,{modelValue:t.value.image,"onUpdate:modelValue":e[2]||(e[2]=u=>t.value.image=u),"max-width":"100%",variant:"outlined",accept:"image/png, image/jpeg, image/bmp",label:"Avatar",placeholder:"Pick an avatar","prepend-icon":"mdi-camera",onChange:o,counter:"",required:""},null,8,["modelValue"]),m.value?(b(),Q(p,{key:0,src:m.value,"max-width":"60","max-height":"60",class:"pa-0 ma-0"},null,8,["src"])):K("",!0)])]),_:1})]),_:1}),a(N,null,{default:n(()=>[a(g,{color:"red darken-1",variant:"text",onClick:e[3]||(e[3]=u=>s.value=!1)},{default:n(()=>e[6]||(e[6]=[y(" Cancel ")])),_:1}),a(g,{loading:r.value,color:"primary",variant:"flat",disabled:!v.value||r.value,onClick:x},{default:n(()=>e[7]||(e[7]=[y(" Submit ")])),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}}),X=R(J,[["__scopeId","data-v-0981021f"]]),Y=q({__name:"DeleteStudentFormDialog",props:{item:{}},setup(c){const d=c,s=f(!1),r=f(!1),w=E();async function t(m){console.log(m.name),r.value=!0;try{await D.deleteStudent(m.id),w.invalidateQueries({queryKey:["students"]}),s.value=!1}catch(o){alert(`Failed to delete student: ${o}`)}finally{r.value=!1}}return(m,o)=>{const v=l("v-btn"),x=l("v-card-title"),i=l("v-card-text"),e=l("v-card"),g=l("v-card-actions"),V=l("v-dialog");return b(),S(T,null,[a(v,{icon:"mdi-delete",variant:"plain",loading:r.value,disabled:r.value,onClick:o[0]||(o[0]=_=>s.value=!0)},null,8,["loading","disabled"]),a(V,{modelValue:s.value,"onUpdate:modelValue":o[3]||(o[3]=_=>s.value=_),"max-width":"600"},{default:n(()=>[a(e,{class:"pa-4"},{default:n(()=>[a(x,{class:"px-2"},{default:n(()=>o[4]||(o[4]=[y("Delete student?")])),_:1}),a(e,{class:"ma-2",color:"yellow",variant:"tonal"},{default:n(()=>[a(i,{class:"text-medium-emphasis text-lg"},{default:n(()=>o[5]||(o[5]=[y(" Warning: All his progress, data will be removed permanently ")])),_:1})]),_:1}),a(g,null,{default:n(()=>[a(v,{color:"green darken-1",variant:"text",onClick:o[1]||(o[1]=_=>s.value=!1)},{default:n(()=>o[6]||(o[6]=[y(" Cancel ")])),_:1}),a(v,{loading:r.value,color:"red",variant:"flat",disabled:r.value,onClick:o[2]||(o[2]=_=>t(d.item))},{default:n(()=>o[7]||(o[7]=[y(" Delete ")])),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}}),Z={class:"text-center"},h={key:0},ee={key:1},ne=q({__name:"StudentsView",setup(c){const d=f(""),s=[{title:"Avatar",value:"image"},{title:"Login",value:"login"},{title:"Name",value:"name"},{title:"Class",value:"user_data.school_student.name"},{title:"Active",value:"active"},{title:"Actions",value:"actions"}],{isPending:r,isError:w,data:t,error:m}=O({queryKey:["students"],queryFn:async()=>await D.getStudents()});return(o,v)=>{const x=l("v-text-field"),i=l("v-spacer"),e=l("v-card-title"),g=l("v-divider"),V=l("v-avatar"),_=l("v-data-table"),C=l("v-card");return b(),Q(C,{flat:"",width:"100%"},{default:n(()=>[a(e,{class:"d-flex align-center pb-4"},{default:n(()=>[a(x,{modelValue:d.value,"onUpdate:modelValue":v[0]||(v[0]=p=>d.value=p),density:"compact",label:"Search","prepend-inner-icon":"mdi-magnify",variant:"solo-filled",flat:"","hide-details":"","single-line":""},null,8,["modelValue"]),a(i),a(G)]),_:1}),a(g),a(_,{search:d.value,"onUpdate:search":v[1]||(v[1]=p=>d.value=p),headers:s,items:U(t),loading:U(r),class:"px-4"},{"header.actions":n(()=>v[2]||(v[2]=[$("div",{class:"text-center"},null,-1)])),"item.image":n(({item:p})=>[a(V,{color:"grey",image:p.image||""},null,8,["image"])]),"item.actions":n(({item:p})=>[$("div",Z,[a(X,{item:p},null,8,["item"]),a(Y,{item:p},null,8,["item"])])]),"no-data":n(()=>{var p;return[U(w)?(b(),S("div",h,M((p=U(m))==null?void 0:p.message),1)):(b(),S("div",ee," No data yet... "))]}),_:1},8,["search","items","loading"])]),_:1})}}});export{ne as default};
