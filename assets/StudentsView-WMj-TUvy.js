import{a as k,u as E,b as T}from"./api-client-VCmGk3ZT.js";import{d as q,a as f,k as j,l as O,b as t,o as b,m as S,e as a,w as n,g as y,n as B,f as $,c as Q,p as I,_ as K,F as R,u as U,t as M}from"./index-cj25IQ4H.js";import"./base-url-qR72hEjy.js";const D={async getStudents(){const c=await k.get("/school/student/list/");return console.log(c.data),c.data},async addStudent(c){return(await k.post("/school/student/",c,{headers:{"Content-Type":"multipart/form-data"}})).data},async updateStudent(c,d){return(await k.put(`/school/student/${c}`,d,{headers:{"Content-Type":"multipart/form-data"}})).data},async deleteStudent(c){return(await k.delete(`/school/student/${c}`)).data}},W={class:"d-flex"},z=q({__name:"AddStudentFormDialog",setup(c){const d=f(!1),r=f(!1),u=f(!1),w=E(),l=f({name:"",login:"",password:"",image:null}),v=f(null),o=i=>{const e=i.target;e.files&&e.files[0]&&(l.value.image=e.files[0],v.value=URL.createObjectURL(e.files[0]))},m=j(()=>l.value.login&&l.value.password&&l.value.name),x=async()=>{if(!m.value)return alert("Please fill in all fields and upload an avatar.");const i=new FormData;i.append("name",l.value.name),i.append("login",l.value.login),i.append("password",l.value.password),l.value.image!=null&&i.append("image",l.value.image),u.value=!0;try{await D.addStudent(i),w.invalidateQueries({queryKey:["students"]}),d.value=!1}catch(e){alert(`Failed to add student: ${e}`)}finally{u.value=!1}};return O(d,i=>{i==!1&&(l.value={name:"",login:"",password:"",image:null},v.value=null)}),(i,e)=>{const g=t("v-btn"),V=t("v-card-title"),_=t("v-text-field"),C=t("v-file-input"),p=t("v-img"),F=t("v-form"),A=t("v-card-text"),N=t("v-card-actions"),L=t("v-card"),P=t("v-dialog");return b(),S("div",null,[a(g,{color:"green",variant:"flat",onClick:e[0]||(e[0]=s=>d.value=!0)},{default:n(()=>e[8]||(e[8]=[y(" + Add ")])),_:1}),a(P,{modelValue:d.value,"onUpdate:modelValue":e[7]||(e[7]=s=>d.value=s),"max-width":"600"},{default:n(()=>[a(L,{class:"pa-4"},{default:n(()=>[a(V,{class:"px-2"},{default:n(()=>e[9]||(e[9]=[y("Create a New Student")])),_:1}),a(A,null,{default:n(()=>[a(F,{onSubmit:B(x,["prevent"])},{default:n(()=>[a(_,{modelValue:l.value.name,"onUpdate:modelValue":e[1]||(e[1]=s=>l.value.name=s),type:"text",density:"compact",label:"Name",placeholder:"Name Surname","prepend-inner-icon":"mdi-account-outline",variant:"outlined",required:""},null,8,["modelValue"]),a(_,{modelValue:l.value.login,"onUpdate:modelValue":e[2]||(e[2]=s=>l.value.login=s),type:"email",density:"compact",label:"Email",placeholder:"Email address","prepend-inner-icon":"mdi-email-outline",variant:"outlined",required:""},null,8,["modelValue"]),a(_,{modelValue:l.value.password,"onUpdate:modelValue":e[3]||(e[3]=s=>l.value.password=s),"append-inner-icon":r.value?"mdi-eye-off":"mdi-eye",type:r.value?"text":"password",density:"compact",label:"Password",placeholder:"Enter password","prepend-inner-icon":"mdi-lock-outline",variant:"outlined","onClick:appendInner":e[4]||(e[4]=s=>r.value=!r.value),required:""},null,8,["modelValue","append-inner-icon","type"]),$("div",W,[a(C,{modelValue:l.value.image,"onUpdate:modelValue":e[5]||(e[5]=s=>l.value.image=s),"max-width":"100%",variant:"outlined",accept:"image/png, image/jpeg, image/bmp",label:"Avatar",placeholder:"Pick an avatar","prepend-icon":"mdi-camera",onChange:o,counter:"",required:""},null,8,["modelValue"]),v.value?(b(),Q(p,{key:0,src:v.value,"max-width":"60","max-height":"60",class:"pa-0 ma-0"},null,8,["src"])):I("",!0)])]),_:1})]),_:1}),a(N,null,{default:n(()=>[a(g,{color:"red darken-1",variant:"text",onClick:e[6]||(e[6]=s=>d.value=!1)},{default:n(()=>e[10]||(e[10]=[y(" Cancel ")])),_:1}),a(g,{loading:u.value,color:"primary",variant:"flat",disabled:!m.value||u.value,onClick:x},{default:n(()=>e[11]||(e[11]=[y(" Submit ")])),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),G=K(z,[["__scopeId","data-v-dc85d31a"]]),H={class:"d-flex"},J=q({__name:"UpdateStudentFormDialog",props:{item:{}},setup(c){const d=c,r=f(!1),u=f(!1),w=E(),l=f({name:d.item.name,image:null}),v=f(null);v.value=d.item.image;const o=i=>{const e=i.target;e.files&&e.files[0]&&(l.value.image=e.files[0],v.value=URL.createObjectURL(e.files[0]))},m=j(()=>l.value.name),x=async()=>{if(!m.value)return alert("Please fill in all fields and upload an avatar.");const i=new FormData;i.append("name",l.value.name),l.value.image!=null&&i.append("image",l.value.image),u.value=!0;try{await D.updateStudent(d.item.id,i),w.invalidateQueries({queryKey:["students"]}),r.value=!1}catch(e){alert(`Failed to update student: ${e}`)}finally{u.value=!1}};return(i,e)=>{const g=t("v-btn"),V=t("v-card-title"),_=t("v-text-field"),C=t("v-file-input"),p=t("v-img"),F=t("v-form"),A=t("v-card-text"),N=t("v-card-actions"),L=t("v-card"),P=t("v-dialog");return b(),S(R,null,[a(g,{icon:"mdi-pencil",variant:"plain",onClick:e[0]||(e[0]=s=>r.value=!0)}),a(P,{modelValue:r.value,"onUpdate:modelValue":e[4]||(e[4]=s=>r.value=s),"max-width":"600"},{default:n(()=>[a(L,{class:"pa-4"},{default:n(()=>[a(V,{class:"px-2"},{default:n(()=>e[5]||(e[5]=[y("Update Student")])),_:1}),a(A,null,{default:n(()=>[a(F,{onSubmit:B(x,["prevent"])},{default:n(()=>[a(_,{modelValue:l.value.name,"onUpdate:modelValue":e[1]||(e[1]=s=>l.value.name=s),type:"text",density:"compact",label:"Name",placeholder:"Name Surname","prepend-inner-icon":"mdi-account-outline",variant:"outlined",required:""},null,8,["modelValue"]),$("div",H,[a(C,{modelValue:l.value.image,"onUpdate:modelValue":e[2]||(e[2]=s=>l.value.image=s),"max-width":"100%",variant:"outlined",accept:"image/png, image/jpeg, image/bmp",label:"Avatar",placeholder:"Pick an avatar","prepend-icon":"mdi-camera",onChange:o,counter:"",required:""},null,8,["modelValue"]),v.value?(b(),Q(p,{key:0,src:v.value,"max-width":"60","max-height":"60",class:"pa-0 ma-0"},null,8,["src"])):I("",!0)])]),_:1})]),_:1}),a(N,null,{default:n(()=>[a(g,{color:"red darken-1",variant:"text",onClick:e[3]||(e[3]=s=>r.value=!1)},{default:n(()=>e[6]||(e[6]=[y(" Cancel ")])),_:1}),a(g,{loading:u.value,color:"primary",variant:"flat",disabled:!m.value||u.value,onClick:x},{default:n(()=>e[7]||(e[7]=[y(" Submit ")])),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}}),X=K(J,[["__scopeId","data-v-237981ca"]]),Y=q({__name:"DeleteStudentFormDialog",props:{item:{}},setup(c){const d=c,r=f(!1),u=f(!1),w=E();async function l(v){console.log(v.name),u.value=!0;try{await D.deleteStudent(v.id),w.invalidateQueries({queryKey:["students"]}),r.value=!1}catch(o){alert(`Failed to delete student: ${o}`)}finally{u.value=!1}}return(v,o)=>{const m=t("v-btn"),x=t("v-card-title"),i=t("v-card-text"),e=t("v-card"),g=t("v-card-actions"),V=t("v-dialog");return b(),S(R,null,[a(m,{icon:"mdi-delete",variant:"plain",loading:u.value,disabled:u.value,onClick:o[0]||(o[0]=_=>r.value=!0)},null,8,["loading","disabled"]),a(V,{modelValue:r.value,"onUpdate:modelValue":o[3]||(o[3]=_=>r.value=_),"max-width":"600"},{default:n(()=>[a(e,{class:"pa-4"},{default:n(()=>[a(x,{class:"px-2"},{default:n(()=>o[4]||(o[4]=[y("Delete student?")])),_:1}),a(e,{class:"ma-2",color:"yellow",variant:"tonal"},{default:n(()=>[a(i,{class:"text-medium-emphasis text-lg"},{default:n(()=>o[5]||(o[5]=[y(" Warning: All his progress, data will be removed permanently ")])),_:1})]),_:1}),a(g,null,{default:n(()=>[a(m,{color:"green darken-1",variant:"text",onClick:o[1]||(o[1]=_=>r.value=!1)},{default:n(()=>o[6]||(o[6]=[y(" Cancel ")])),_:1}),a(m,{loading:u.value,color:"red",variant:"flat",disabled:u.value,onClick:o[2]||(o[2]=_=>l(d.item))},{default:n(()=>o[7]||(o[7]=[y(" Delete ")])),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}}),Z={class:"text-center"},h={key:0},ee={key:1},ne=q({__name:"StudentsView",setup(c){const d=f(""),r=[{title:"Avatar",value:"image"},{title:"Name",value:"name"},{title:"Class",value:"user_data.school_class_id"},{title:"Active",value:"active"},{title:"Actions",value:"actions"}],{isPending:u,isError:w,data:l,error:v}=T({queryKey:["students"],queryFn:async()=>await D.getStudents()});return(o,m)=>{const x=t("v-text-field"),i=t("v-spacer"),e=t("v-card-title"),g=t("v-divider"),V=t("v-avatar"),_=t("v-data-table"),C=t("v-card");return b(),Q(C,{flat:"",width:"100%"},{default:n(()=>[a(e,{class:"d-flex align-center pb-4"},{default:n(()=>[a(x,{modelValue:d.value,"onUpdate:modelValue":m[0]||(m[0]=p=>d.value=p),density:"compact",label:"Search","prepend-inner-icon":"mdi-magnify",variant:"solo-filled",flat:"","hide-details":"","single-line":""},null,8,["modelValue"]),a(i),a(G)]),_:1}),a(g),a(_,{search:d.value,"onUpdate:search":m[1]||(m[1]=p=>d.value=p),headers:r,items:U(l),loading:U(u),class:"px-4"},{"header.actions":n(()=>m[2]||(m[2]=[$("div",{class:"text-center"},null,-1)])),"item.image":n(({item:p})=>[a(V,{color:"grey",image:p.image||""},null,8,["image"])]),"item.actions":n(({item:p})=>[$("div",Z,[a(X,{item:p},null,8,["item"]),a(Y,{item:p},null,8,["item"])])]),"no-data":n(()=>{var p;return[U(w)?(b(),S("div",h,M((p=U(v))==null?void 0:p.message),1)):(b(),S("div",ee," No data yet... "))]}),_:1},8,["search","items","loading"])]),_:1})}}});export{ne as default};
